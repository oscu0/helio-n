# helio-n: полный журнал разработки (по истории git)

223 коммита, октябрь 2025 — февраль 2026.  
Автор: Anton Shiryaev.  
Коммиты с префиксом «Codex:» / «Copilot:» сделаны AI-ассистентом по запросу автора.

---

## 24 октября 2025 — Инициализация репозитория

| Дата | Коммит | Описание |
|------|--------|----------|
| 24.10 | `aa26939` | Начальный коммит: создание репозитория на GitHub |
| 24.10 | `39fae4e` | Добавлена иконка папки |
| 24.10 | `4ae4828` | Обновление .gitignore |
| 24.10 | `b7ac45b` | Начальный коммит (вторая ветка) |
| 24.10 | `759a436` | Outputs/ добавлена в .gitignore |
| 24.10 | `9d397d3` | Создана папка Outputs/ |
| 24.10 | `2b0cb09` | Обновлены пути в импорте qlook |
| 24.10 | `f42db2c` | Добавлен README.md |
| 24.10 | `1b5d3be` | Обновлена ссылка на изображение в README |

---

## 7 ноября 2025 — Первый прототип нейросети

| Дата | Коммит | Описание |
|------|--------|----------|
| 07.11 | `6529c7a` | Синхронизация |
| 07.11 | `faa0e76` | Чтение предрассчитанного pickle вместо повторного вычисления |
| 07.11 | `9885247` | **Первый коммит CH Mask Generator**: ноутбук с U-Net для генерации масок корональных дыр + conda-окружение `icme3.12-nn` |
| 07.11 | `fb46d0d` | Слияние веток |
| 07.11 | `05e13f8` | Фикс .gitignore для данных CH |
| 07.11 | `5d22d48` | Апдейт после слияния |

---

## 9–10 ноября 2025 — Эксперименты с архитектурой и бэкендом

| Дата | Коммит | Описание |
|------|--------|----------|
| 09.11 | `6b08587` | **Тяжёлая модель 512px с 16 базовыми фильтрами**: увеличение разрешения с 256 до 512 px и количества параметров |
| 10.11 | `6f5873b` | Фикс окружения Python 3.12 |
| 10.11 | `f95c09d` | Добавлено окружение Python 3.10 с поддержкой Metal GPU (macOS) |
| 10.11 | `f8d89a6` | **Аугментация данных и браузер результатов модели**: добавлено усиление данных (data augmentation) и инструмент просмотра предсказаний |
| 10.11 | `fbeea96` | **Коммит модели перед обсуждением с научным руководителем**: сохранён файл `model_CH_UNet.h5` (≈94 МБ) |
| 10.11 | `7bd973e` | Состояние «до JAX»: последний коммит перед переходом на JAX бэкенд |
| 10.11 | `693a2e3` | Добавлен jax-metal в окружение 3.10 для аппаратного ускорения на Apple Silicon |

---

## 13–14 ноября 2025 — Переход на Keras + JAX

| Дата | Коммит | Описание |
|------|--------|----------|
| 13.11 | `6ec1f4a` | **Переписано на чистый Keras с JAX-бэкендом**: переход от TF/Keras к Keras 3 + JAX |
| 14.11 | `58104c4` | **Более тяжёлая модель; FITS-данные теперь ориентированы так же, как маски**: исправление ориентации магнитограмм HMI для согласованности с масками EUV |
| 14.11 | `1d4862d` | Обновление README |
| 14.11 | `b9f9c00` | Удалена старая модель из репозитория (слишком большой файл), путь добавлен в .gitignore |

---

## 22 ноября 2025 — Метрики, Фурье-анализ, рефакторинг в модули

| Дата | Коммит | Описание |
|------|--------|----------|
| 22.11 | `bc0a068` | **Добавлены метрики изображений** (IoU, Dice и др.), реорганизованы структуры данных для сохранения на диск |
| 22.11 | `9e62ddb` | Обновление окружений, добавлен requirements.txt |
| 22.11 | `0568e87` | Фикс .gitignore |
| 22.11 | `f876158` | **Добавлен Фурье-анализ масок** в Mathematica (Analysis/Fourier Mask Analysis.nb) |
| 22.11 | `927206c` | **Конфиги в JSON**: параметры модели и сглаживания читаются/записываются в человеко-читаемые JSON-файлы |
| 22.11 | `5285a2e` | **Разделение ноутбука на скрипты**: выделены Library/IO.py, Library/Metrics.py, Library/Model.py, Library/Processing.py |
| 22.11 | `eb32ebe` | Дальнейшее разделение на скрипты; добавлены parquet-файлы с путями датасетов |
| 22.11 | `49b9708` | Перемещение окружений в Config/Environment Defs/ |
| 22.11 | `bc4abfb` | Начальные фиксы путей для новой структуры каталогов |
| 22.11 | `fef0038` | Library и Scripts стали Python-модулями (добавлены `__init__.py`) |
| 22.11 | `29f5c95` | Удалены мусорные файлы |
| 22.11 | `84fa97e` | Более Mac-подобный путь к модели |
| 22.11 | `632d5c9` | Фикс аргумента model в save_pmap() |
| 22.11 | `8784edc` | Фикс повреждённых импортов PIL |
| 22.11 | `efdc0c4` | **Parquet вместо pickle** для ≈40-кратного уменьшения размера файлов с путями |
| 22.11 | `b3a0ae6` | Дальнейшие фиксы импортов |
| 22.11 | `0e9358d` | **Нормализация представления и разрешения масок**: сгенерированные и ground truth маски приведены к единому формату и разрешению |
| 22.11 | `2b3860e` | Добавлены списки несопоставленных масок и FITS-файлов |
| 22.11 | `b9f8059` | Добавлен прогресс-бар в Scripts/Apply.py |

---

## 26 ноября 2025 — Поддержка PMAP в .npy, статистика за 2014 год

| Дата | Коммит | Описание |
|------|--------|----------|
| 26.11 | `3eac92c` | Определение и работа с PMAP (probability maps), сохранёнными как .npy |
| 26.11 | `a281f48` | **Калькулятор статистики за 2014 год**, новая семантика PMAP в Library |

---

## 4 декабря 2025 — Исправление метрик проекции

| Дата | Коммит | Описание |
|------|--------|----------|
| 04.12 | `42df806` | **Исправлены проекционные метрики**: расчёт относительной площади КД приведён в соответствие с методами IDL-конвейера |
| 04.12 | `4f14c04` | Синхронизация артефактов данных |

---

## 7 декабря 2025 — Фиксация зависимостей

| Дата | Коммит | Описание |
|------|--------|----------|
| 07.12 | `446413e` | Обновление окружения с замороженными версиями пакетов |

---

## 27–28 декабря 2025 — Добавление HMI, эксперименты, переход на TensorFlow

| Дата | Коммит | Описание |
|------|--------|----------|
| 27.12 | `ccaa0b3` | **Добавлен сбор HMI-данных**: магнитограммы HMI как дополнительный вход; пути зависят от хостнейма машины |
| 27.12 | `ac9ddad` | Хранение артефактов по хостнейму |
| 27.12 | `f55b815` | Добавлен скрипт построения списка файлов (Scripts/Make.py) |
| 27.12 | `55564c0` | Реорганизация структуры каталогов |
| 27.12 | `ed53749` | Обновление .gitignore |
| 27.12 | `8e47503` | **Поддержка экспериментов**: конфигурация архитектуры и диапазонов дат через JSON |
| 27.12 | `706ea35` | Постпроцессинг добавлен в структуру эксперимента |
| 27.12 | `ba6eae4` | Расширенная поддержка сглаживания в структуре эксперимента |
| 27.12 | `1ea13ce` | Улучшение пользовательского интерфейса ноутбука (выбор постобработки) |
| 27.12 | `48bcc1c` | Имена файлов PMAP теперь содержат метки эксперимента; фиксы ошибок |
| 28.12 | `8eedca1` | Сохранение визуализаций рядом с картами вероятностей |
| 28.12 | `c92338d` | Фикс интерактивных графиков и сохранения масок |
| 28.12 | `a12f5cd` | Удалён неподдерживаемый аргумент из функции сохранения масок |
| 28.12 | `1f0c069` | [Codex] Нечёткое сопоставление FITS-файлов по дате |
| 28.12 | `67d9fe6` | Фикс генерации PMAP при разрешении ≠ 1024 |
| 28.12 | `7079ec3`–`bc34c37` | Серия обновлений и фиксов CUDA-окружения |
| 28.12 | `5c74b9e` | Дальнейшее уточнение CUDA-окружения |
| 28.12 | `83e17cb` | .gitkeep в папке Models/ |
| 28.12 | `096e254` | Добавлены артефакты сборки для кластера miracle |
| 28.12 | `1695949` | Более робастное сопоставление масок |
| 28.12 | `303c71b` | [Codex] Фикс интерактивного графика в CH Mask Generator |
| 28.12 | `244c651` | **Переписано на TensorFlow.Keras** (возврат с JAX), новые окружения |
| 28.12 | `1489dec` | Обновление версий NVIDIA-пакетов в CUDA-окружении |
| 28.12 | `b46dba9` | Фикс зависимостей CUDA-окружения; подавление лишнего TF-вывода |
| 28.12 | `9d264b7` | Зафиксированы дополнительные версии пакетов |
| 28.12 | `e9a2690` | Удалены пути к PMAP из parquet (могут быть определены из пути маски) |
| 28.12 | `6af51fb` | Обновление артефактов для miracle |
| 28.12 | `e7292b1` | Удалены deprecated-вызовы |
| 28.12 | `f843fc7` | Фикс пайплайна обработки без PMAP; обновление артефактов risc1 |
| 28.12 | `aaa9f4e` | Фиксы графиков |

---

## 28–29 декабря 2025 — Оптимизация инференса: батчинг, JIT, параллелизм

| Дата | Коммит | Описание |
|------|--------|----------|
| 28.12 | `6f43fc4` | Скомпилированная функция инференса |
| 29.12 | `394e41c` | [Codex] Добавлен батчинг при инференсе |
| 29.12 | `c3b3b52` | Размер батча читается из конфига |
| 29.12 | `c1a21ae` | Параллелизация построения графиков после генерации PMAP |
| 29.12 | `082816e` | [Codex] Пул графиков по всем GPU-батчам |
| 29.12 | `b43d3fb` | [Codex] Оптимизация построения графиков |
| 29.12 | `b5529ca`/`a40e990` | Фиксы структуры конфигурации (параллельные ветки) |
| 29.12 | `4c4205f` | Слияние веток |
| 29.12 | `ecaabe1` | [Codex] Обработка FITS с повреждёнными координатами без краша |
| 29.12 | `84ca24c` | [Codex] Пул процессов; генерация солнечного овала один раз |
| 29.12 | `903ea96` | [Codex] Настоящий параллелизм (процессы вместо потоков) |
| 29.12 | `2c6cde4` | Фикс семантики функции сохранения графиков |
| 29.12 | `6d67e97` | [Codex] (нераспознанный коммит) |
| 29.12 | `9a1af5d` | Добавлен файл конфигурации графиков (Plot.json) |
| 29.12 | `a46d695` | **JIT-компиляция и уменьшение ретрейсинга** в model.infer |
| 29.12 | `300adf9` | Рефакторинг скомпилированной функции инференса |
| 29.12 | `a2008ad` | Фикс расчёта относительной площади КД |
| 29.12 | `9368c8c` | Фиксы сохранения .npy |
| 29.12 | `2ea7fde` | Переиспользование базового графика |
| 29.12 | `6b550a7` | Пакетное изменение размера входных данных модели |

---

## 30 декабря 2025 — Увеличение батча на risc1

| Дата | Коммит | Описание |
|------|--------|----------|
| 30.12 | `7bde56d` | Увеличен размер батча на кластере risc1 |

---

## 3 января 2026 — Подготовка эксперимента A2D1, оптимизация обучения

| Дата | Коммит | Описание |
|------|--------|----------|
| 03.01 | `b349894` | **Подготовлен эксперимент A2D1**: избежание 8-битной квантизации при обучении модели. Добавлена конфигурация архитектуры A2 |
| 03.01 | `a6f766b`/`6af377d` | Исправление опечатки в build_unet() (параллельные ветки) |
| 03.01 | `96f024e` | Слияние |
| 03.01 | `3468db4` | Дальнейшие фиксы ошибок в функциях обучения |
| 03.01 | `49ac5e0` | Автоматический расчёт steps per epoch |
| 03.01 | `338df5f` | [Codex] Улучшенная архитектура конфигурации |
| 03.01 | `3f826e1` | **A2: устранены лишние проходы** по тренировочным данным при использовании каждого N-го изображения |
| 03.01 | `d69817a` | [Codex] Использование tf.data API с кэшированием |
| 03.01 | `0589ab1` | [Codex] prepare_fits хранит и map, и proc. map данные для инференса |
| 03.01 | `8a4a5b4` | [Codex] Не передавать модель из Apply (оптимизация памяти) |
| 03.01 | `18df407` | [Codex] Использование процессов вместо потоков |
| 03.01 | `3a6973f`–`b289d13` | [Codex] Исправления дублирования имён файлов при string substitution |
| 03.01 | `857dae1` | [Codex] Более продвинутые таймеры для профилирования |
| 03.01 | `75d3247` | Подавление предупреждений |
| 03.01 | `03c9b39` | [Codex] Паддинг данных для избежания рекомпиляции XLA на последнем батче |

---

## 4 января 2026 — Чанкинг, генератор синоптических датасетов

| Дата | Коммит | Описание |
|------|--------|----------|
| 04.01 | `cd5dc7c` | Обновление конфига для чанкинга и miracle |
| 04.01 | `8740678` | [Codex] Добавлен чанкинг при инференсе (обработка данных порциями) |
| 04.01 | `d6ffce3` | Более разумное начальное значение размера чанка |
| 04.01 | `0e9f7ef` | Расчёт количества in-flight чанков из размера чанка |
| 04.01 | `9a6ec4c` | Более робастное подавление предупреждений |
| 04.01 | `bd4a14c` | Перемещение сохранения .npy в рабочие потоки |
| 04.01 | `1527712` | Минорный рефакторинг |
| 04.01 | `33dc291` | Приём переменной $MACHINE для выбора конфигурации машины |
| 04.01 | `6c246c7` | Фикс опечатки в пути сохранённой модели |
| 04.01 | `e02e24a` | Обновление путей для miracle_mini |
| 04.01 | `54ecbcc` | [Codex] Наследование конфигурации |
| 04.01 | `c66bc03` | Увеличен размер чанка |
| 04.01 | `edf2a15` | Опциональная генерация почасового dataframe; удалён лишний try-блок |
| 04.01 | `74c7ab4` | Режим hourly df задаётся через аргумент командной строки |
| 04.01 | `cdefd55` | **Добавлен генератор синоптических датасетов** (Scripts/Make/Synoptic.py) |
| 04.01 | `0f26902` | [Codex] Скрипт генерации мини-датасетов |
| 04.01 | `2f20ebe` | [Codex] Возврат к np/tflow-загрузчикам для модели |
| 04.01 | `28e2e9d` | Почасовой parquet на miracle |

---

## 5 января 2026 — Фиксы датасет-билдера, README, inplace-режим

| Дата | Коммит | Описание |
|------|--------|----------|
| 05.01 | `3d85258` | Фикс опечатки в датасет-билдере |
| 05.01 | `cf1c44d` | Hourly df builder по умолчанию отключён |
| 05.01 | `2388f95` | Добавлен README |
| 05.01 | `808cbd8` | Обновлены корневые пути risc1 |
| 05.01 | `86363c2` | [Codex] Передача путей вместо PMAP через IPC; фикс бага в сохранении масок |
| 05.01 | `edaff3c` | Обновление артефактов risc1 |
| 05.01 | `6398f57` | **Удалён нефункциональный путь «avoid quantization»** |
| 05.01 | `4ea7011` | Удалено лишнее отражение при сохранении масок на быстром пути |
| 05.01 | `7446acf` | Более строгое сопоставление масок |
| 05.01 | `d21e0c6` | **Добавлен inplace-режим** в Make Synoptic (перезапись FITS на месте) |

---

## 6 января 2026 — Stats-скрипт, AGENTS.md, CLI

| Дата | Коммит | Описание |
|------|--------|----------|
| 06.01 | `635d414` | Предупреждение о недостающих PMAP; сохранение ad hoc-сгенерированных |
| 06.01 | `90c2f05` | Добавлен AGENTS.md (инструкции для AI-ассистента) |
| 06.01 | `6977c18` | **Добавлен скрипт Make Stats** (Scripts/Make/Stats.py) |
| 06.01 | `a1d3f1c` | Поддержка отсутствия omask в метриках |
| 06.01 | `d0b39c6` | Обновление AGENTS.md |
| 06.01 | `703b5f0` | Обновление ноутбука |
| 06.01 | `d790ec1` | [Codex] Обновлённая семантика CLI |
| 06.01 | `dc7d1b9` | Добавлен inplace-режим для синоптических в README |
| 06.01 | `a6226eb` | Обновление README |
| 06.01 | `9a830c3` | Обновление графиков, добавлена статистика |
| 06.01 | `b1cc104` | Слияние |

---

## 7–8 января 2026 — Эксперимент A0, отладка модели, анализ яркости

| Дата | Коммит | Описание |
|------|--------|----------|
| 07.01 | `1888764` | **Добавлена тестовая конфигурация A0** (минимальный эксперимент) |
| 08.01 | `fdebb18` | **Добавлен ноутбук для отладки модели** (Model Debug.ipynb) |
| 08.01 | `f4d10c1` | **Анализ яркости**: исследование распределения интенсивности/яркости EUV-данных |
| 08.01 | `be55b33` | Переключатель перегенерации PMAP |
| 08.01 | `d3a6a5a` | **Выделение Stats.ipynb из CH Mask Generator**: статистический анализ вынесен в отдельный ноутбук |

---

## 9–11 января 2026 — Отладка воспроизводимости A1D1, рефакторинг в Models/, определение A2

| Дата | Коммит | Описание |
|------|--------|----------|
| 09.01 | `e99cae5` | **Попытка отладки обучения модели**: изменения в конфигурации A0/A2, Library/IO, Library/Model |
| 11.01 | `3f0c341` | **Дальнейшие попытки отладки воспроизводимости A1D1**: добавлен Scripts/Overfit.py для тестов переобучения |
| 11.01 | `3e56cc6` | [Codex] **Рефакторинг конфигов моделей в пакет Models/**: JSON-конфиги заменены Python-модулями (Models/A0.py, A1.py, A2.py, _base.py, `__init__.py`) |
| 11.01 | `16e1d75` | [Codex] **Определение многолетнего тренировочного сплита A2**: годы 2011, 2015, 2018, 2020 с перемешиванием и 90/10 разбиением |
| 11.01 | `caba31c` | [Codex] Опции мультипроцессинга для обучения |
| 11.01 | `42a2c56` | Фикс сопоставления HMI NRT |
| 11.01 | `79b11d1` | Добавлен монитор обучения; переименование D0 → D1 в A0 |
| 11.01 | `2e71298` | **A2: одно наблюдение в день вместо каждого 4-го сэмпла** — изменение стратегии прореживания данных |
| 11.01 | `6ecafc8` | Ограничение максимального смещения даты от синоптической до 3 часов |
| 11.01 | `889cf7f` | [Codex] Опция пропуска существующих PMAP |
| 11.01 | `33983bf` | [Codex] Более робастное регулярное выражение для HMI |
| 11.01 | `9d3c82b` | Фикс опечатки в regex |
| 11.01 | `4a5b622` | **A2: исправлено прореживание по датам** — стабилизация логики one-per-day |

---

## 12 января 2026 — A1D2, IDL vs U-Net

| Дата | Коммит | Описание |
|------|--------|----------|
| 12.01 | `110e630` | Улучшен путь parquet для статистики |
| 12.01 | `3f79c2c` | Предупреждение при запуске Make Synoptic с установленной $MACHINE |
| 12.01 | `326f426` | Обновлённые артефакты risc1 от исправленного синоптического датасета |
| 12.01 | `66a4e93` | **Переименование A0 date range в A1** для согласованности с остальными моделями |
| 12.01 | `8942344` | **Добавлен A1 D2**: новый диапазон дат для архитектуры A1 (январь 2022 — январь 2023) |
| 12.01 | `b191d00` | Фикс опечатки в A1 |
| 12.01 | `3d324b9` | Изменение диапазона дат A1 D2 |
| 12.01 | `55c2e99` | **A1D2: каденс 6 часов** (keep_every=6) |
| 12.01 | `640fe95`/`5d29f4f` | **Генератор подвыборки IDL vs U-Net**: инструмент для формирования наборов данных для сравнения IDL-конвейера с U-Net |
| 12.01 | `f0b3a51` | Слияние |

---

## 19 января 2026 — Статистика для тезисов, анализ солнечного ветра

| Дата | Коммит | Описание |
|------|--------|----------|
| 19.01 | `91d3220` | Подавление предупреждений о моментах Цернике для КД с нулевым радиусом |
| 19.01 | `ce4aca8` | **Анализ солнечного ветра для тезисов**: добавлен ноутбук SW 2.ipynb с анализом данных qlook за 2017 год |
| 19.01 | `c92fcca` | **Добавлена статистика A1 и A2**: расчёт метрик для обеих архитектур |
| 19.01 | `e3d17ed` | Stats: устойчивость к повреждённым PMAP |
| 19.01 | `bc3c3ce` | Подавление предупреждений mahotas для КД нулевого радиуса |
| 19.01 | `fda4982` | **Обновление Stats.ipynb для тезисов** |

---

## 27–30 января 2026 — A2D2, глобальное хранение статистики, площади КД

| Дата | Коммит | Описание |
|------|--------|----------|
| 27.01 | `c588d2a` | **Добавлен A2 D2**: второй date range для A2 — без прореживания «одно наблюдение в день», используются все доступные данные |
| 28.01 | `5f59cc7` | **Добавлена статистика A2D2** |
| 28.01 | `6e19ca5` | Обновление путей miracle_mini |
| 30.01 | `8891206` | **Глобальное хранение статистики** (а не привязанное к конкретному артефакту) |
| 30.01 | `f227be1` | Удалены старые файлы статистики (перемещены в новое расположение) |
| 30.01 | `c76dda7` | Обновлено имя диска для risc1 |
| 30.01 | `62c33c6` | **Добавлен скрипт расчёта площадей КД** (Scripts/Make/CH Areas.py) |

---

## 2–3 февраля 2026 — Оптимизация расчёта площадей

| Дата | Коммит | Описание |
|------|--------|----------|
| 02.02 | `b9600c4` | Фиксы генератора CH |
| 02.02 | `7d40317` | Обновление артефактов risc1 |
| 02.02 | `dfffe6e` | Кэширование результатов при расчёте площадей |
| 02.02 | `42eca75` | [Codex] Параллельный расчёт синоптических площадей |
| 02.02 | `f3bf590` | [Codex] Фиксы параллелизации |
| 02.02 | `4db1089` | Изменение логики чанкинга для скрипта CH Areas |
| 03.02 | `864f393` | **Добавлены данные площадей КД** (2010–2025) для расчёта скорости солнечного ветра |

---

## 4–7 февраля 2026 — DTW, ACE данные, ICME, SRI RAS

| Дата | Коммит | Описание |
|------|--------|----------|
| 04.02 | `b7d685b` | userpwd.py добавлен в .gitignore |
| 06.02 | `4de8f6f` | [Codex] Добавлен dtaidistance (Dynamic Time Warping) в окружения |
| 07.02 | `95148cf` | Обновление инструкций коммитов в AGENTS.md |
| 07.02 | `86b42cf` | **Добавлен загрузчик данных ACE @ Earth** и данные о солнечном ветре (ace_at_earth_1h.parquet) |
| 07.02 | `c2af210` | **Зеркало списка ICME** |

---

## 9–11 февраля 2026 — Подготовка к докладу SRI RAS

| Дата | Коммит | Описание |
|------|--------|----------|
| 09.02 | `ca4cb53` | [Codex] Добавлен pytplot в conda-окружения |
| 11.02 | `b9d8e5f` | [Copilot] Диапазон дат в Stats |
| 11.02 | `d5421e4` | [Copilot] Поддержка множественных моделей в Stats |
| 11.02 | `aef9071` | **Добавлены почасовые данные площадей КД для доклада ИКИ РАН** |
| 11.02 | `1a555b4` | Удалён дубликат stats parquet |
| 11.02 | `8507fe9` | [Codex] Добавлен openpyxl в conda-окружения |
| 11.02 | `c805297` | **Дополнительные данные почасовых площадей КД для доклада ИКИ РАН** |
| 11.02 | `77f950b` | Слияние (HEAD) |
